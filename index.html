<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <style>
    body {
      font-family: 'Prompt', sans-serif;
      background: linear-gradient(135deg, #c01a1a, #1487d4); /* พื้นหลังชัดเจน */
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
    }
    .register-card {
      max-width: 420px;
      width: 100%;
      background: #fff;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      animation: fadeIn 0.8s ease-in-out;
    }
    h3 {
      font-weight: 600;
      color: #4e73df;
    }
    .form-label {
      font-weight: 500;
      color: #333;
    }
    .btn-custom {
      background: #4e73df;
      color: white;
      font-weight: 600;
      transition: 0.3s;
    }
    .btn-custom:hover {
      background: #2e59d9;
      transform: translateY(-3px);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="register-card">
    <h3 class="text-center mb-4">Register</h3>
    <form id="regForm">
      <!-- เลือก Role -->
      <div class="mb-3">
        <label class="form-label"><i class="bi bi-person-badge"></i> Role</label>
        <select id="role" class="form-control" required>
          <option value="">-</option>
          <option value="customer">User</option>
          <option value="service">Service</option>
        </select>
      </div>

      <!-- ฟิลด์ลูกค้า -->
      <div id="customerFields" class="hidden">
        <div class="mb-3">
          <label class="form-label"><i class="bi bi-hospital"></i> Hospital</label>
          <input type="text" class="form-control" id="hospital" required>
        </div>
        <div class="mb-3">
          <label class="form-label"><i class="bi bi-envelope"></i> Email</label>
          <input type="email" class="form-control" id="email">
        </div>
      </div>

      <!-- ฟิลด์ช่าง -->
      <div id="techFields" class="hidden">
        <div class="mb-3">
          <label class="form-label"><i class="bi bi-shield-lock"></i> Service Code</label>
          <input type="password" class="form-control" id="techCode">
        </div>
      </div>

      <button type="submit" class="btn btn-custom w-100">Register</button>
    </form>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyrvICyAumiiBU4g7L48DtTZSZwnMt1NFxBtPOwIWy-Ne2U36-GUWlt7Sk7ilvCSs9CcA/exec"; // ใส่ Google Script URL ของคุณ
    const SERVICE_CODE = "1234";
    const roleSelect = document.getElementById("role");
    const customerFields = document.getElementById("customerFields");
    const techFields = document.getElementById("techFields");

    roleSelect.addEventListener("change", function() {
      if (this.value === "customer") {
        customerFields.classList.remove("hidden");
        techFields.classList.add("hidden");
         // บังคับ required เฉพาะลูกค้า
        document.getElementById("hospital").setAttribute("required", true);
        document.getElementById("email").setAttribute("required", true);
        document.getElementById("techCode").removeAttribute("required");

      } else if (this.value === "service") {
        techFields.classList.remove("hidden");
        customerFields.classList.add("hidden");
        // บังคับ required เฉพาะช่าง
        document.getElementById("techCode").setAttribute("required", true);
        document.getElementById("hospital").removeAttribute("required");
        document.getElementById("email").removeAttribute("required");

      } else {
        customerFields.classList.add("hidden");
        techFields.classList.add("hidden");
        // ลบ required ออกทั้งหมด
        document.getElementById("hospital").removeAttribute("required");
        document.getElementById("email").removeAttribute("required");
        document.getElementById("techCode").removeAttribute("required");
      }
    });

    document.getElementById("regForm").addEventListener("submit", function(e){
      e.preventDefault();
      let role = document.getElementById("role").value;
      let data = { type: "register", role: role };

      if (role === "customer") {
        data.hospital = document.getElementById("hospital").value;
        data.email = document.getElementById("email").value;
        //เก็บไว้ใน localStorage
        localStorage.setItem("hospital", data.hospital);
        localStorage.setItem("email", data.email);
      } else if (role === "service") {
        data.techCode = document.getElementById("techCode").value;
        if (data.techCode !== SERVICE_CODE) {
          alert("❌ Service code ไม่ถูกต้อง")
          return;
        }
      }

      fetch(SCRIPT_URL, {
        method: "POST",
        //headers: { "Content-Type": "application/json" }, อีควายนี่ทำให้กูต้องกลับช้า อิสัส
        body: JSON.stringify(data)
      })
      .then(res => res.text())
      .then(result => {
        localStorage.setItem("userRole", role);
        window.location.href = "dashboard.html";
      })
      .catch(err => {
        console.error("Fetch error:");
        alert("❌ Error: " + err);
      });
    });
  </script>
</body>
</html>